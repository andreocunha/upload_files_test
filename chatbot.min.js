// ¬©2022 Andr√© Oliveira Cunha e Bruno Angeloti e Andr√© Louis

const answersResult=[];const data=[{question:'Ol√°, tudo bem?<br><br>Vamos consultar o Pre√ßo para sua Cota√ß√£o em 5 min?',options:['Vamos l√°!'],type:'select',},{question:'Para isso preciso de algumas informa√ß√µes r√°pidas üôÇ<br><br>Qual √© o seu nome?',type:'input',},{question:'Prazer em te conhecer, ${answersResult[1]}!<br><br>Em qual e-mail corporativo gostaria de receber a proposta?',type:'input',},{question:'√ìtimo, ${answersResult[1]}!<br><br>Poderia me informar seu telefone? (Prometo n√£o incomodarüôè)',type:'input',},{question:'Legal, estamos quase l√°...<br><br>De qual empresa voc√™ fala?',type:'input',},{question:'Qual sua principal necessidade?',options:['Aumentar as vendas','Aumentar a produtividade','Aumentar a efici√™ncia','Aumentar a satisfa√ß√£o dos clientes'],type:'select',},{question:'Por √∫ltimo, qual √© o n√∫mero de colaboradores de sua empresa?',options:['1 a 10','11 a 100','101 a 500','501 a 1000','Mais de 1000'],type:'select',},{question:'Fa√ßa um breve resumo do que voc√™ precisa',type:'input',},{question:'https://api.whatsapp.com/send?phone=552792823473&text=Ol√°, meu nome √© ${answersResult[1]} e gostaria de receber uma cota√ß√£o para minha empresa ${answersResult[4]}.',type:'none'}]
let content=null;let input=null;let inputArea=null;async function sendEmail(body,email){await fetch('https://disparador-emails-moddev.vercel.app/api/email',{method:'POST',headers:{'Accept':'application/json, text/plain, */*','Content-Type':'application/json','Access-Control-Allow-Credentials':'true','Access-Control-Allow-Origin':'*','Access-Control-Allow-Methods':'GET, POST, PUT, DELETE, OPTIONS','Access-Control-Allow-Headers':'Origin, X-Requested-With, Content-Type, Accept'},body:JSON.stringify({body,subject:'Cota√ß√£o para empresa'+" "+answersResult[4],email,})}).then(response=>response.json()).then(data=>{console.log(data);}).catch(error=>console.log(error));}
function createQuestion(question){const div=document.createElement('div');div.classList.add('question-moddev');if(question.question.includes('${answersResult[1]}')){question.question=question.question.replace('${answersResult[1]}',answersResult[1]);}if(question.question.includes('${answersResult[2]}')){question.question=question.question.replace('${answersResult[2]}',answersResult[2]);}if(question.question.includes('${answersResult[3]}')){question.question=question.question.replace('${answersResult[3]}',answersResult[3]);}if(question.question.includes('${answersResult[4]}')){question.question=question.question.replace('${answersResult[4]}',answersResult[4]);}if(question.question.includes('${answersResult[5]}')){question.question=question.question.replace('${answersResult[5]}',answersResult[5]);}if(question.question.includes('${answersResult[6]}')){question.question=question.question.replace('${answersResult[6]}',answersResult[6]);}if(question.question.includes('${answersResult[7]}')){question.question=question.question.replace('${answersResult[7]}',answersResult[7]);}
if(question.type==='input'){div.innerHTML=`
      <p>${question.question}</p>
      `;inputArea.style.display='flex';input.disabled=false;input.focus();input.addEventListener('keyup',getInputValue);}else if(question.type==='select'){div.innerHTML=`
    <p>${question.question}</p>
    <div class="options-moddev">
      ${question.options.map(option => `<button
onclick="removeOptions(this, '${option}')">${option}</button>`).join('')}
    </div>
  `;}
else{sendEmail(`
      nome: ${answersResult[1]}
      email: ${answersResult[2]}
      telefone: ${answersResult[3]}
      empresa: ${answersResult[4]}
      necessidade: ${answersResult[5]}
      colaboradores: ${answersResult[6]}
      resumo: ${answersResult[7]}
    `,"moddev.br@gmail.com");sendEmail(`
      Ol√°, ${answersResult[1]}!

      Obrigado por entrar em contato com a Moddev. Estamos analisando sua cota√ß√£o e em breve entraremos em contato.

      Caso tenha alguma d√∫vida, entre em contato conosco pelo WhatsApp: +55(27) 99282-3473.

      Abra√ßos,

      Equipe Moddev
    `,answersResult[2]);div.innerHTML=`<p>Nossos consultores est√£o analisando sua cota√ß√£o e em breve entraremos em contato. Obrigado! Caso queira entre em contato conosco por nosso Whatsapp.</p>`;content.appendChild(div);content.innerHTML+=`
    <a class="whatsapp-moddev" href="${question.question}" target="_blank">
      <img src="https://img.icons8.com/color/48/000000/whatsapp--v1.png" width="30px" height="30px" alt="icone do whatsapp"/>
      <p>
          Fale conosco
      </p>
    </a>
    `;return}
content.appendChild(div);}
function removeOptions(option,answer){option.parentNode.remove();createAnswer(answer);}
function getInputValue(e){if((input.disabled==false)&&(e.keyCode===13||e.type==='click')){const value=input.value;input.value='';input.disabled=true;inputArea.style.display='none';createAnswer(value);}}
function createAnswer(answer){answersResult.push(answer);const div=document.createElement('div');div.classList.add('answer-moddev');div.innerHTML=`
    <p>${answer}</p>
  `;content.appendChild(div);animateTyping();}
function nextQuestion(){const questions=document.querySelectorAll('.question-moddev');const index=questions.length-1;if(index<data.length-1){createQuestion(data[index+1]);}}
function scrollToBottom(){setTimeout(()=>{const content=document.querySelector('.content-moddev')
content.scrollTop=content.scrollHeight;},50);setTimeout(()=>{const content=document.querySelector('.content-moddev')
content.scrollTop=content.scrollHeight;},300);}
function animateTyping(){scrollToBottom();const div=document.createElement('div');div.classList.add('typing-moddev');div.innerHTML=`
  <lottie-player src="https://assets10.lottiefiles.com/packages/lf20_nZBVpi.json"  background="transparent"  speed="1.8"  style="width: 80px;" loop autoplay></lottie-player>
  `;content.appendChild(div);scrollToBottom();setTimeout(()=>{div.remove();nextQuestion();scrollToBottom();},2200);}
function startBot(){document.querySelector('.chat-icon-message-moddev').style.display='none';animateTyping();}
function createChatArea(){const div=document.createElement('div');div.innerHTML=`
  <lottie-player class="mascot-moddev" src="https://lottie.host/acdc7517-679e-4ddf-8f3f-5f4a17f3c715/nvxXKgDDfK.json" background="transparent" speed="0.8" style="width: 150px; height: 150px;" loop autoplay></lottie-player>
  <div class="container-moddev">
      <div class="header-moddev">
          <img src="https://res.cloudinary.com/dj1ereyp0/image/upload/v1666743604/Logos/Branca/SingleSVG_ju7nne.svg" alt="Avatar" class="avatar-moddev" width="40px" height="40px" />
          <div class="header-text-moddev">
              <h4>Moddev</h4>
              <p>Online agora</p>
          </div>
          <button onclick="closeModal()" class="header-close-moddev">
            x
          </button>
      </div>
      <div class="content-moddev" id="content-moddev"></div>
      <div class="input-area-moddev" id="input-area-moddev">
          <input class="input-moddev" id="input-moddev" disabled type="text" placeholder="Digite aqui..." />
          <div class="send-moddev" id="send-moddev"></div>
      </div>
  </div>
  `;document.body.appendChild(div);content=document.getElementById('content-moddev');input=document.getElementById('input-moddev');inputArea=document.getElementById('input-area-moddev');}
function closeModal(){document.querySelector('.chat-icon-moddev').classList.remove('hide');document.querySelector('.container-moddev').classList.remove('active');document.querySelector('.mascot-moddev').classList.remove('active');}
function createIcon(){const div=document.createElement('div');div.innerHTML=`
  <div class="chat-icon-moddev">
    <img src="https://res.cloudinary.com/dj1ereyp0/image/upload/v1667095954/Logos/mascote_dra28f.svg" alt="Avatar" class="avatar-moddev" width="60px" height="60px" />
    <div class="chat-icon-message-moddev">Em que a <strong>MODDEV</strong></br> pode te ajudar hoje?</div>
  </div>
  `;document.body.appendChild(div);div.addEventListener('click',()=>{document.querySelector('.container-moddev').classList.add('active');document.querySelector('.chat-icon-moddev').classList.add('hide');document.querySelector('.mascot-moddev').classList.add('active');if(content.innerHTML===''){startBot();}});}
window.addEventListener('load',()=>{const script=document.createElement('script');script.src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js";script.async=true;document.body.appendChild(script);const style=document.createElement('link');style.rel="stylesheet";style.href="https://andreocunha.github.io/upload_files_test/styles.css";document.body.appendChild(style);createChatArea();createIcon();});
